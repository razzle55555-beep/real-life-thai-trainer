<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Real Life Thai Trainer (Car Mode)</title>
  <style>
    body { font-family: system-ui, Arial; margin: 20px; max-width: 780px; }
    button { padding: 12px 16px; font-size: 18px; margin-right: 10px; }
    .mono { font-family: ui-monospace, Consolas, monospace; white-space: pre-wrap; font-size: 16px; }
    .row { display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin: 10px 0; }
    input { padding: 10px; font-size: 16px; width: 120px; }
    .hint { opacity: 0.75; font-size: 14px; margin-top: 6px; }
  </style>
</head>
<body>
  <h2>Real Life Thai Trainer — Car Mode (iPhone)</h2>

  <div class="row">
    <button id="start">Start</button>
    <button id="stop">Stop</button>

    <label>EN hold ms</label><input id="holdEn" value="1200">
    <label>Pause before TH ms</label><input id="pauseBeforeTh" value="600">
    <label>Pause normal→slow ms</label><input id="pauseNS" value="1000">
    <label>Gap after phrase ms</label><input id="gapAfter" value="1200">
  </div>

  <div class="hint">
    iPhone tip: Tap <b>Start</b> once to allow audio. If Thai voice is silent, enable/download a Thai voice in iOS:
    Settings → Accessibility → Spoken Content → Voices → Thai.
  </div>

  <p class="mono" id="status">idle</p>

<script>
(() => {
  // ===== YOUR PHRASES (EN, TH, PRON display-only) =====
  const phrases = [
  ["Good morning", "สวัสดีครับ", "sà-wàt-dee kráp"],
  ["How are you?", "เป็นยังไงบ้างครับ", "bpen yang-ngai bâang kráp"],
  ["I am doing good", "ผมสบายดีครับ", "phǒm sà-baai dee kráp"],
  ["Did you sleep well?", "นอนหลับดีไหมครับ", "non làp dee mái kráp"],
  ["How is your mom doing?", "คุณแม่เป็นยังไงบ้างครับ", "khun mâe bpen yang-ngai bâang kráp"],
  ["I miss you very much", "ผมคิดถึงคุณมากครับ", "phǒm khít-thʉ̌ng khun mâak kráp"],
  ["Did you eat?", "กินข้าวหรือยังครับ", "gin kâao rʉ̌ʉ yang kráp"],
  ["I don't understand", "ผมไม่เข้าใจครับ", "phǒm mâi kâo-jai kráp"],
];


  // ===== STATE =====
  let running = false;
  let idx = 0;

  const statusEl = document.getElementById("status");
  const startBtn = document.getElementById("start");
  const stopBtn = document.getElementById("stop");

  const holdEnEl = document.getElementById("holdEn");
  const pauseBeforeThEl = document.getElementById("pauseBeforeTh");
  const pauseNSEl = document.getElementById("pauseNS");
  const gapAfterEl = document.getElementById("gapAfter");

  function setStatus(t){ statusEl.textContent = t; }

  function toInt(el, fallback) {
    const n = parseInt((el.value || "").trim(), 10);
    return Number.isFinite(n) ? n : fallback;
  }

  function sleep(ms) { return new Promise(r => setTimeout(r, ms)); }

  // ===== NATIVE SPEECH (NO GOOGLE / NO NETWORK) =====
  function speak(text, lang, rate = 1.0) {
    return new Promise((resolve) => {
      try {
        // Cancel queue to keep it responsive when looping
        window.speechSynthesis.cancel();

        const u = new SpeechSynthesisUtterance(text);
        u.lang = lang;
        u.rate = rate;
        u.onend = () => resolve();
        u.onerror = () => resolve(); // don't crash loop on voice issues

        window.speechSynthesis.speak(u);
      } catch {
        resolve();
      }
    });
  }

  async function loop() {
    running = true;

    while (running) {
      const [en, th, pron] = phrases[idx];

      const HOLD_EN_MS = toInt(holdEnEl, 1200);
      const PAUSE_BEFORE_THAI_MS = toInt(pauseBeforeThEl, 600);
      const PAUSE_BETWEEN_NORMAL_AND_SLOW_MS = toInt(pauseNSEl, 1000);
      const GAP_AFTER_PHRASE_MS = toInt(gapAfterEl, 1200);

      const EN_RATE = 1.0;
      const TH_NORMAL_RATE = 1.0;
      const TH_SLOW_RATE = 0.6;

      // EN
      setStatus(`EN: ${en}\nTH: ${th}\nPRON: ${pron || ""}`);
      await speak(en, "en-US", EN_RATE);
      if (!running) break;

      await sleep(HOLD_EN_MS);
      if (!running) break;

      // Pause before Thai
      setStatus(`(pause)\nTH: ${th}\nPRON: ${pron || ""}`);
      await sleep(PAUSE_BEFORE_THAI_MS);
      if (!running) break;

      // TH normal
      setStatus(`TH normal: ${th}\nPRON: ${pron || ""}`);
      await speak(th, "th-TH", TH_NORMAL_RATE);
      if (!running) break;

      await sleep(PAUSE_BETWEEN_NORMAL_AND_SLOW_MS);
      if (!running) break;

      // TH slow
      setStatus(`TH slow: ${th}\nPRON: ${pron || ""}`);
      await speak(th, "th-TH", TH_SLOW_RATE);
      if (!running) break;

      // Gap
      setStatus(`(gap)\nNext up: ${phrases[(idx + 1) % phrases.length][0]}`);
      await sleep(GAP_AFTER_PHRASE_MS);
      if (!running) break;

      idx = (idx + 1) % phrases.length;
    }

    running = false;
    setStatus("stopped");
  }

  startBtn.addEventListener("click", () => {
    if (!running) loop();
  });

  stopBtn.addEventListener("click", () => {
    running = false;
    try { window.speechSynthesis.cancel(); } catch {}
  });

  // Safety: if tab closes, stop speaking
  window.addEventListener("beforeunload", () => {
    try { window.speechSynthesis.cancel(); } catch {}
  });
})();
</script>
</body>
</html>
